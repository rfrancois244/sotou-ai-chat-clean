<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Sotou AI Chat</title>
<style>
body {
font-family: Arial, sans-serif;
background: #0f172a;
color: #e5e7eb;
display: flex;
justify-content: center;
align-items: center;
height: 100vh;
margin: 0;
}
.chat-box {
width: 420px;
background: #020617;
border-radius: 8px;
padding: 16px;
box-shadow: 0 0 20px rgba(0,0,0,0.6);
}
h1 {
text-align: center;
font-size: 20px;
margin: 0 0 12px 0;
color: #38bdf8;
}
#messages {
height: 260px;
overflow-y: auto;
border: 1px solid #1e293b;
padding: 10px;
margin-bottom: 10px;
background: #020617;
border-radius: 6px;
white-space: pre-wrap;
}
.user { color: #facc15; margin-bottom: 8px; }
.bot { color: #22c55e; margin-bottom: 10px; }
.err { color: #fb7185; margin-bottom: 10px; }

input {
width: 100%;
padding: 10px;
border-radius: 6px;
border: none;
margin-bottom: 8px;
box-sizing: border-box;
}
button {
width: 100%;
padding: 10px;
background: #38bdf8;
border: none;
border-radius: 6px;
color: #000;
font-weight: bold;
cursor: pointer;
}
button:disabled { opacity: 0.6; cursor: not-allowed; }
</style>
</head>

<body>
<div class="chat-box">
<h1>Sotou AI Chat</h1>
<div id="messages"></div>
<input id="input" placeholder="Ask Sotou AI..." />
<button id="sendBtn">Send</button>
</div>

<script>
const input = document.getElementById("input");
const messages = document.getElementById("messages");
const sendBtn = document.getElementById("sendBtn");

function addLine(cls, text) {
const div = document.createElement("div");
div.className = cls;
div.textContent = text;
messages.appendChild(div);
messages.scrollTop = messages.scrollHeight;
}

async function sendMessage() {
const text = input.value.trim();
if (!text) return;

addLine("user", `You: ${text}`);
input.value = "";
sendBtn.disabled = true;

try {
const response = await fetch("/api/chat", {
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({ message: text })
});

const raw = await response.text(); // read once

if (!response.ok) {
addLine("err", `Server error (${response.status}): ${raw}`);
return;
}

const data = JSON.parse(raw);
addLine("bot", `Sotou AI: ${data.reply ?? "(no reply field returned)"}`);
} catch (e) {
addLine("err", `Network error: ${e.message}`);
} finally {
sendBtn.disabled = false;
input.focus();
}
}

sendBtn.addEventListener("click", sendMessage);
input.addEventListener("keydown", (e) => {
if (e.key === "Enter") sendMessage();
});
</script>
</body>
</html>
